---
sidebar_position: 99
title: "OwnerTwoStepsMod"
description: "ERC-173 Two-Step Contract Ownership Library - Provides two-step ownership transfer logic for facets or modular contracts."
gitSource: "https://github.com/maxnorm/Compose/blob/56196d950dad5f803c271d96961275928a79b519/src/access/OwnerTwoSteps/OwnerTwoStepsMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
ERC-173 Two-Step Contract Ownership Library - Provides two-step ownership transfer logic for facets or modular contracts.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Ensures safe, two-step ownership changes requiring explicit acceptance by the pending owner.
- Provides robust access control mechanisms through &#x60;requireOwner&#x60;.
- Integrates cleanly with diamond storage, maintaining upgrade-safe ownership state.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The OwnerTwoStepsMod module implements ERC-173 two-step ownership management for Compose diamonds. It provides secure and explicit control over ownership transitions, ensuring that ownership change requires explicit confirmation from the new recipient. The module safeguards facets relying on owner-restricted logic by enforcing clear ownership rules and preserving storage integrity across upgrades.

---

## Storage

### OwnerStorage

**Note:** storage-location: erc8042:compose.owner

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct OwnerStorage {
address owner;
}`}
</ExpandableCode>

---
### PendingOwnerStorage

**Note:** storage-location: erc8042:compose.owner.pending

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct PendingOwnerStorage {
address pendingOwner;
}`}
</ExpandableCode>

Storage position: &#x60;OWNER_STORAGE_POSITION&#x60; - Used for diamond storage pattern.
---
### State Variables

<PropertyTable
  properties={[
    {
      name: "OWNER_STORAGE_POSITION",
      type: "bytes32",
      description: " (Value: `keccak256(&quot;compose.owner&quot;)`)"
    },
    {
      name: "PENDING_OWNER_STORAGE_POSITION",
      type: "bytes32",
      description: " (Value: `keccak256(&quot;compose.owner.pending&quot;)`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### acceptOwnership

Finalizes ownership transfer; must be called by the pending owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function acceptOwnership() ;`}
</ExpandableCode>

---
### getOwnerStorage

Returns a pointer to the Owner storage struct. Uses inline assembly to access the storage slot defined by OWNER_STORAGE_POSITION. **Returns**

<ExpandableCode language="solidity" maxLines={8}>
{`function getOwnerStorage() pure returns (OwnerStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "OwnerStorage",
      description: "The OwnerStorage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### getPendingOwnerStorage

Returns a pointer to the PendingOwner storage struct. Uses inline assembly to access the storage slot defined by PENDING_OWNER_STORAGE_POSITION. **Returns**

<ExpandableCode language="solidity" maxLines={8}>
{`function getPendingOwnerStorage() pure returns (PendingOwnerStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "PendingOwnerStorage",
      description: "The PendingOwnerStorage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### owner

Returns the current owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function owner() view returns (address);`}
</ExpandableCode>

---
### pendingOwner

Returns the pending owner (if any).

<ExpandableCode language="solidity" maxLines={8}>
{`function pendingOwner() view returns (address);`}
</ExpandableCode>

---
### renounceOwnership

Renounce ownership of the contract Sets the owner to address(0), disabling all functions restricted to the owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function renounceOwnership() ;`}
</ExpandableCode>

---
### requireOwner

Reverts if the caller is not the owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function requireOwner() view;`}
</ExpandableCode>

---
### transferOwnership

Initiates a two-step ownership transfer. **Parameters**

<ExpandableCode language="solidity" maxLines={8}>
{`function transferOwnership(address _newOwner) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_newOwner",
      type: "address",
      description: "The address of the new owner of the contract"
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="OwnershipTransferStarted" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when ownership transfer is initiated (pending owner set).
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event OwnershipTransferStarted(address indexed _previousOwner, address indexed _newOwner);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="OwnershipTransferred" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when ownership transfer is finalized.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event OwnershipTransferred(address indexed _previousOwner, address indexed _newOwner);`}
      </ExpandableCode>
    </div>

  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="OwnerAlreadyRenounced" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error OwnerAlreadyRenounced();
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="OwnerUnauthorizedAccount" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error OwnerUnauthorizedAccount();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

/**
 * Example facet integrating OwnerTwoStepsMod for ownership control.
 */
contract OwnershipFacet {
    function transferOwnership(address _newOwner) external {
        OwnerTwoStepsMod.transferOwnership(_newOwner);
    }

    function acceptOwnership() external {
        OwnerTwoStepsMod.acceptOwnership();
    }

    function getOwner() external view returns (address) {
        return OwnerTwoStepsMod.owner();
    }

    function getPendingOwner() external view returns (address) {
        return OwnerTwoStepsMod.pendingOwner();
    }

    function renounceOwnership() external {
        OwnerTwoStepsMod.renounceOwnership();
    }

    function requireOwnerAction() external {
        OwnerTwoStepsMod.requireOwner();
        // Add owner-restricted logic here.
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always confirm ownership transfers by explicitly calling &#x60;acceptOwnership&#x60;.
- Avoid setting &#x60;address(0)&#x60; as the new owner unless intentional; this renounces ownership and permanently disables owner-restricted functionality.
- Use &#x60;requireOwner&#x60; in functions that should only be accessible to the current owner to enforce access control.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
OwnerTwoStepsMod interfaces directly with diamond storage using well-defined and unique storage slots. The &#x60;getOwnerStorage&#x60; and &#x60;getPendingOwnerStorage&#x60; functions provide low-level access pointers, ensuring that facets can reliably interact with shared ownership state. Changes in &#x60;owner&#x60; or &#x60;pendingOwner&#x60; are immediately visible to all facets accessing these properties. Ordering is critical: ensure that &#x60;transferOwnership&#x60; is called before &#x60;acceptOwnership&#x60;, and that &#x60;requireOwner&#x60; wraps sensitive operations to enforce ownership logic.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="OwnerTwoStepsMod" />
</div>

<LastUpdated date="2025-12-16T00:43:20.341Z" />

---
sidebar_position: 99
title: "DiamondMod"
description: "Diamond Library - Internal functions and storage for diamond proxy functionality."
---

import DocHero from '@site/src/components/docs/DocHero';
import Callout from '@site/src/components/ui/Callout';
import PropertyTable from '@site/src/components/api/PropertyTable';

## Overview

Diamond Library - Internal functions and storage for diamond proxy functionality.

[View Source](https://github.com/maxnorm/Compose/blob/bd92d896acdf08abd003a5846f267d6de9578ab5/src/diamond/DiamondMod.sol)

<Callout type="info" title="Key Features">
- All functions are &#x60;internal&#x60; for use in custom facets
- Follows diamond storage pattern (EIP-8042)
- Compatible with ERC-2535 diamonds
- No external dependencies or &#x60;using&#x60; directives
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Structs

### FacetCutAction

Add&#x3D;0, Replace&#x3D;1, Remove&#x3D;2

### DiamondStorage

**Note:** storage-location: erc8042:compose.diamond

```solidity
struct DiamondStorage {
mapping(bytes4 functionSelector &#x3D;&gt; FacetAndPosition) facetAndPosition;
/**
 * &#x60;selectors&#x60; contains all function selectors that can be called in the diamond.
 */
bytes4[] selectors;
}
```

### FacetAndPosition

```solidity
struct FacetAndPosition {
address facet;
uint32 position;
}
```

### FacetCut

```solidity
struct FacetCut {
address facetAddress;
FacetCutAction action;
bytes4[] functionSelectors;
}
```

## Storage

Storage position: &#x60;DIAMOND_STORAGE_POSITION&#x60; - Used for diamond storage pattern.

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "bytes32",
      description: " (Value: `keccak256(&quot;compose.diamond&quot;)`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### addFacets

Adds facets and their function selectors to the diamond. Only supports adding functions during diamond deployment.

```solidity
function addFacets(FacetCut[] memory _facets) ;
```

<PropertyTable
  properties={[
    {
      name: "_facets",
      type: "FacetCut[]",
      description: ""
    }
  ]}
  showRequired={false}
/>

### diamondFallback

Find facet for function that is called and execute the function if a facet is found and return any value.

```solidity
function diamondFallback() ;
```

### getStorage

```solidity
function getStorage() pure returns (DiamondStorage storage s);
```

## Events

### DiamondCut

```solidity
event DiamondCut(FacetCut[] _diamondCut, address _init, bytes _calldata);
```

## Errors

### CannotAddFunctionToDiamondThatAlreadyExists

```solidity
error CannotAddFunctionToDiamondThatAlreadyExists(bytes4 _selector);
```

### FunctionNotFound

```solidity
error FunctionNotFound(bytes4 _selector);
```

### InvalidActionWhenDeployingDiamond

```solidity
error InvalidActionWhenDeployingDiamond(address facetAddress, FacetCutAction action, bytes4[] functionSelectors);
```

### NoBytecodeAtAddress

```solidity
error NoBytecodeAtAddress(address _contractAddress, string _message);
```

## Integration Notes

<Callout type="success" title="Shared Storage">
This module accesses shared diamond storage, so changes made through this module are immediately visible to facets using the same storage pattern. All functions are internal as per Compose conventions.
</Callout>

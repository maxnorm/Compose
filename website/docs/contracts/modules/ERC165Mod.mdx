---
sidebar_position: 99
title: "ERC165Mod"
description: "LibERC165 — ERC-165 Standard Interface Detection Library - Provides internal functions and storage layout for ERC-165 interface detection."
gitSource: "https://github.com/maxnorm/Compose/blob/56196d950dad5f803c271d96961275928a79b519/src/interfaceDetection/ERC165/ERC165Mod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
LibERC165 — ERC-165 Standard Interface Detection Library - Provides internal functions and storage layout for ERC-165 interface detection.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides efficient support for ERC-165 interface detection through fixed diamond storage.
- Allows seamless integration for other facets to query supported interfaces.
- Simplifies initialization and maintenance of ERC-165 compliance within diamonds.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

ERC165Mod provides utilities to implement and manage ERC-165 interface detection in a diamond. It allows registering supported interface IDs and querying interface support efficiently while adhering to the diamond storage pattern for state isolation and reuse.

---

## Storage

### ERC165Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC165Storage {
/*
 * @notice Mapping of interface IDs to whether they are supported
 */
mapping(bytes4 => bool) supportedInterfaces;
}`}
</ExpandableCode>

Storage position: &#x60;STORAGE_POSITION&#x60; - Used for diamond storage pattern.
---
### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: " (Value: `keccak256(&quot;compose.erc165&quot;)`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the ERC-165 storage struct. Uses inline assembly to bind the storage struct to the fixed storage position. **Returns**

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (ERC165Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC165Storage",
      description: "The ERC-165 storage struct."
    }
  ]}
  showRequired={false}
/>

---
### registerInterface

Register that a contract supports an interface Call this function during initialization to register supported interfaces. For example, in an ERC721 facet initialization, you would call: &#x60;LibERC165.registerInterface(type(IERC721).interfaceId)&#x60; **Parameters**

<ExpandableCode language="solidity" maxLines={8}>
{`function registerInterface(bytes4 _interfaceId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_interfaceId",
      type: "bytes4",
      description: "The interface ID to register"
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {LibERC165} from "modules/ERC165Mod.sol";

contract ExampleFacet {
    function initialize() external {
        // Register ERC721 interface
        LibERC165.registerInterface(type(IERC721).interfaceId);
    }

    function supportsInterface(bytes4 interfaceId) external view returns (bool) {
        // Query interface support
        return LibERC165.getStorage().supportedInterfaces[interfaceId];
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always call &#x60;registerInterface&#x60; during facet initialization to declare supported interfaces.
- Avoid modifying ERC-165 storage layout to maintain compatibility with previously deployed diamonds.
- Ensure that each interface ID registered represents a contract-observable interface to preserve ERC-165 compliance.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
ERC165Mod utilizes a fixed storage slot, ensuring that the ERC-165 interface detection data is globally accessible within the diamond. Facets can register interfaces by initializing the storage through &#x60;registerInterface&#x60; and can query the support status directly using storage functions. Proper care must be taken to ensure storage layout compatibility during diamond upgrades, as this module assumes an unaltered structure across lifecycle updates.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC165Mod" />
</div>

<LastUpdated date="2025-12-16T00:47:25.747Z" />

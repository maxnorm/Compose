---
sidebar_position: 99
title: "DiamondCutMod"
description: "Documentation for DiamondCutMod"
---

import DocHero from '@site/src/components/docs/DocHero';
import Callout from '@site/src/components/ui/Callout';


## Overview

Documentation for DiamondCutMod


[View Source](https://github.com/maxnorm/Compose/blob/eabc77b81e461d751a5a8e003c3a9c2e818b9d3c/src/diamond/DiamondCutMod.sol)



<Callout type="info" title="Key Features">
- All functions are `internal` for use in custom facets
- Follows diamond storage pattern (EIP-8042)
- Compatible with ERC-2535 diamonds
- No external dependencies or `using` directives
</Callout>



<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>


## Storage


Storage position: `DIAMOND_STORAGE_POSITION` - Used for diamond storage pattern.



### State Variables


#### DIAMOND_STORAGE_POSITION







## Functions


### addFunctions



```solidity
function addFunctions(address _facet, bytes4[] calldata _functionSelectors) ;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_facet` | `address` |  |

| `_functionSelectors` | `bytes4[]` |  |





### diamondCut


Add/replace/remove any number of functions and optionally execute a function with delegatecall **Parameters**



```solidity
function diamondCut(FacetCut[] calldata _diamondCut, address _init, bytes calldata _calldata) ;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_diamondCut` | `FacetCut[]` | Contains the facet addresses and function selectors |

| `_init` | `address` | The address of the contract or facet to execute _calldata |

| `_calldata` | `bytes` | A function call, including function selector and arguments _calldata is executed with delegatecall on _init |





### getStorage



```solidity
function getStorage() pure returns (DiamondStorage storage s);
```





### removeFunctions



```solidity
function removeFunctions(address _facet, bytes4[] calldata _functionSelectors) ;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_facet` | `address` |  |

| `_functionSelectors` | `bytes4[]` |  |





### replaceFunctions



```solidity
function replaceFunctions(address _facet, bytes4[] calldata _functionSelectors) ;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_facet` | `address` |  |

| `_functionSelectors` | `bytes4[]` |  |







## Events


### DiamondCut



```solidity
event DiamondCut(FacetCut[] _diamondCut, address _init, bytes _calldata);
```






## Errors


### CannotAddFunctionToDiamondThatAlreadyExists



```solidity
error CannotAddFunctionToDiamondThatAlreadyExists(bytes4 _selector);
```



### CannotRemoveFunctionThatDoesNotExist



```solidity
error CannotRemoveFunctionThatDoesNotExist(bytes4 _selector);
```



### CannotRemoveImmutableFunction



```solidity
error CannotRemoveImmutableFunction(bytes4 _selector);
```



### CannotReplaceFunctionThatDoesNotExists



```solidity
error CannotReplaceFunctionThatDoesNotExists(bytes4 _selector);
```



### CannotReplaceFunctionWithTheSameFunctionFromTheSameFacet



```solidity
error CannotReplaceFunctionWithTheSameFunctionFromTheSameFacet(bytes4 _selector);
```



### CannotReplaceImmutableFunction



```solidity
error CannotReplaceImmutableFunction(bytes4 _selector);
```



### IncorrectFacetCutAction



```solidity
error IncorrectFacetCutAction(uint8 _action);
```



### InitializationFunctionReverted



```solidity
error InitializationFunctionReverted(address _initializationContractAddress, bytes _calldata);
```



### NoBytecodeAtAddress



```solidity
error NoBytecodeAtAddress(address _contractAddress, string _message);
```



### NoSelectorsProvidedForFacet



```solidity
error NoSelectorsProvidedForFacet(address _facet);
```



### RemoveFacetAddressMustBeZeroAddress



```solidity
error RemoveFacetAddressMustBeZeroAddress(address _facet);
```





## Structs


### FacetCutAction


Add=0, Replace=1, Remove=2




### DiamondStorage


**Note:** storage-location: erc8042:compose.diamond



```solidity
struct DiamondStorage {
mapping(bytes4 functionSelector =&gt; FacetAndPosition) facetAndPosition;
/**
 * Array of all function selectors that can be called in the diamond
 */
bytes4[] selectors;
}
```



### FacetAndPosition



```solidity
struct FacetAndPosition {
address facet;
uint32 position;
}
```



### FacetCut



```solidity
struct FacetCut {
address facetAddress;
FacetCutAction action;
bytes4[] functionSelectors;
}
```









## Integration Notes

<Callout type="success" title="Shared Storage">
This module accesses shared diamond storage, so changes made through this module are immediately visible to facets using the same storage pattern. All functions are internal as per Compose conventions.
</Callout>





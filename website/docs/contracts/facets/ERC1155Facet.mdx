---
sidebar_position: 99
title: "ERC1155Facet"
description: "**Title:**"
gitSource: "https://github.com/maxnorm/Compose/blob/326d9e4b8d8f7ef437a77f59f91bb1619c2d1a6c/src/token/ERC1155/ERC1155Facet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
**Title:**
</DocSubtitle>

<Callout type="info" title="Key Features">
- Full implementation of ERC-1155 standard, including batch operations and approvals.
- Supports flexible token-specific URIs with &#x60;&amp;#123;id&amp;#125;&#x60; replacement for individualized metadata.
- Lightweight storage handling via diamond storage pattern.
</Callout>

## Overview

The ERC1155Facet implements ERC-1155 multi-token standard functionality for a diamond. It provides flexible token management, including batch transfers, per-token URIs, and approvals. This facet enables efficient, composable token operations seamlessly within the diamond&#x27;s modular architecture.

---

## Storage

### ERC1155Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC1155Storage {
    mapping(uint256 id => mapping(address account => uint256 balance)) balanceOf;
    mapping(address account => mapping(address operator => bool)) isApprovedForAll;
    string uri;
    string baseURI;
    mapping(uint256 tokenId => string) tokenURIs;
}`}
</ExpandableCode>

---
### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns the ERC-1155 storage struct from the predefined diamond storage slot. Uses inline assembly to set the storage slot reference.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (ERC1155Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC1155Storage",
      description: "The ERC-1155 storage struct reference."
    }
  ]}
  showRequired={false}
/>

---
### uri

Returns the URI for token type &#x60;_id&#x60;. If a token-specific URI is set in tokenURIs[_id], returns the concatenation of baseURI and tokenURIs[_id]. Note that baseURI is empty by default and must be set explicitly if concatenation is desired. If no token-specific URI is set, returns the default URI which applies to all token types. The default URI may contain the substring &#x60;&amp;#123;id&amp;#125;&#x60; which clients should replace with the actual token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function uri(uint256 _id) external view returns (string memory);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_id",
      type: "uint256",
      description: "The token ID to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The URI for the token type."
    }
  ]}
  showRequired={false}
/>

---
### balanceOf

Returns the amount of tokens of token type &#x60;id&#x60; owned by &#x60;account&#x60;.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOf(address _account, uint256 _id) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_account",
      type: "address",
      description: "The address to query the balance of."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The token type to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The balance of the token type."
    }
  ]}
  showRequired={false}
/>

---
### balanceOfBatch

Batched version of balanceOf.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOfBatch(address[] calldata _accounts, uint256[] calldata _ids)
    external
    view
    returns (uint256[] memory balances);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_accounts",
      type: "address[]",
      description: "The addresses to query the balances of."
    },
    {
      name: "_ids",
      type: "uint256[]",
      description: "The token types to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "balances",
      type: "uint256[]",
      description: "The balances of the token types."
    }
  ]}
  showRequired={false}
/>

---
### setApprovalForAll

Grants or revokes permission to &#x60;operator&#x60; to transfer the caller&#x27;s tokens. Emits an ApprovalForAll event.

<ExpandableCode language="solidity" maxLines={8}>
{`function setApprovalForAll(address _operator, bool _approved) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_operator",
      type: "address",
      description: "The address to grant/revoke approval to."
    },
    {
      name: "_approved",
      type: "bool",
      description: "True to approve, false to revoke."
    }
  ]}
  showRequired={false}
/>

---
### isApprovedForAll

Returns true if &#x60;operator&#x60; is approved to transfer &#x60;account&#x60;&#x27;s tokens.

<ExpandableCode language="solidity" maxLines={8}>
{`function isApprovedForAll(address _account, address _operator) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_account",
      type: "address",
      description: "The token owner."
    },
    {
      name: "_operator",
      type: "address",
      description: "The operator to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the operator is approved, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### safeTransferFrom

Transfers &#x60;value&#x60; amount of token type &#x60;id&#x60; from &#x60;from&#x60; to &#x60;to&#x60;. Emits a TransferSingle event.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeTransferFrom(address _from, address _to, uint256 _id, uint256 _value, bytes calldata _data) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The address to transfer from."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to transfer to."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The token type to transfer."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The amount to transfer."
    },
    {
      name: "_data",
      type: "bytes",
      description: "Additional data with no specified format."
    }
  ]}
  showRequired={false}
/>

---
### safeBatchTransferFrom

Batched version of safeTransferFrom. Emits a TransferBatch event.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeBatchTransferFrom(
    address _from,
    address _to,
    uint256[] calldata _ids,
    uint256[] calldata _values,
    bytes calldata _data
) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The address to transfer from."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to transfer to."
    },
    {
      name: "_ids",
      type: "uint256[]",
      description: "The token types to transfer."
    },
    {
      name: "_values",
      type: "uint256[]",
      description: "The amounts to transfer."
    },
    {
      name: "_data",
      type: "bytes",
      description: "Additional data with no specified format."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="TransferSingle" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when &#x60;value&#x60; amount of tokens of type &#x60;id&#x60; are transferred from &#x60;from&#x60; to &#x60;to&#x60; by &#x60;operator&#x60;.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event TransferSingle(
    address indexed _operator, address indexed _from, address indexed _to, uint256 _id, uint256 _value
);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_operator",
            type: "address",
            description: "The address which initiated the transfer."
          },
          {
            name: "_from",
            type: "address",
            description: "The address which previously owned the token."
          },
          {
            name: "_to",
            type: "address",
            description: "The address which now owns the token."
          },
          {
            name: "_id",
            type: "uint256",
            description: "The token type being transferred."
          },
          {
            name: "_value",
            type: "uint256",
            description: "The amount of tokens transferred."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="TransferBatch" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Equivalent to multiple TransferSingle events, where &#x60;operator&#x60;, &#x60;from&#x60; and &#x60;to&#x60; are the same for all transfers.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event TransferBatch(
    address indexed _operator, address indexed _from, address indexed _to, uint256[] _ids, uint256[] _values
);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_operator",
            type: "address",
            description: "The address which initiated the batch transfer."
          },
          {
            name: "_from",
            type: "address",
            description: "The address which previously owned the tokens."
          },
          {
            name: "_to",
            type: "address",
            description: "The address which now owns the tokens."
          },
          {
            name: "_ids",
            type: "uint256[]",
            description: "The token types being transferred."
          },
          {
            name: "_values",
            type: "uint256[]",
            description: "The amounts of tokens transferred."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="ApprovalForAll" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when &#x60;account&#x60; grants or revokes permission to &#x60;operator&#x60; to transfer their tokens.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event ApprovalForAll(address indexed _account, address indexed _operator, bool _approved);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_account",
            type: "address",
            description: "The token owner granting/revoking approval."
          },
          {
            name: "_operator",
            type: "address",
            description: "The address being approved/revoked."
          },
          {
            name: "_approved",
            type: "bool",
            description: "True if approval is granted, false if revoked."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="URI" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when the URI for token type &#x60;id&#x60; changes to &#x60;value&#x60;.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event URI(string _value, uint256 indexed _id);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_value",
            type: "string",
            description: "The new URI for the token type."
          },
          {
            name: "_id",
            type: "uint256",
            description: "The token type whose URI changed."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC1155InsufficientBalance" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating insufficient balance for a transfer.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InsufficientBalance(address _sender, uint256 _balance, uint256 _needed, uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidSender" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the sender address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the receiver address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155MissingApprovalForAll" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating missing approval for an operator.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155MissingApprovalForAll(address _operator, address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidApprover" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the approver address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidApprover(address _approver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidOperator" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the operator address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidOperator(address _operator);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidArrayLength" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating array length mismatch in batch operations.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidArrayLength(uint256 _idsLength, uint256 _valuesLength);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import { IDiamondCut } from "../interfaces/IDiamondCut.sol";
import { ERC1155Facet } from "./ERC1155Facet.sol";

contract Diamond {
    function addERC1155Facet() external {
        IDiamondCut.FacetCut[] memory diamondCut = new IDiamondCut.FacetCut[](1);
        diamondCut[0] = IDiamondCut.FacetCut({
            facetAddress: address(new ERC1155Facet()),
            action: IDiamondCut.FacetCutAction.Add,
            functionSelectors: abi.encodePacked(
                ERC1155Facet.getStorage.selector,
                ERC1155Facet.uri.selector,
                ERC1155Facet.balanceOf.selector,
                ERC1155Facet.balanceOfBatch.selector,
                ERC1155Facet.setApprovalForAll.selector,
                ERC1155Facet.isApprovedForAll.selector,
                ERC1155Facet.safeTransferFrom.selector,
                ERC1155Facet.safeBatchTransferFrom.selector
            )
        });
        IDiamondCut(address(this)).diamondCut(diamondCut, address(0), "");
    }

    function useERC1155Facet() external {
        ERC1155Facet erc1155Facet = ERC1155Facet(address(this));
        erc1155Facet.setApprovalForAll(address(0x123), true);
        erc1155Facet.safeTransferFrom(msg.sender, address(0x456), 1, 100, "");
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize token metadata, including URIs and supply, during deployment or via separate setup functions.
- Use &#x60;getStorage&#x60; to access and ensure proper state management via diamond storage.
- Regularly audit function selectors when adding/upgrading facets to maintain ABI compatibility.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Validate input addresses to prevent transferring tokens to invalid addresses. Ensure reentrancy protection, especially in externally-calling functions like &#x60;safeTransferFrom&#x60; and &#x60;safeBatchTransferFrom&#x60;. When setting or concatenating base URIs, validate data integrity to prevent invalid or unexpected URI behavior.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC1155Facet" />
</div>

<LastUpdated date="2025-12-15T21:47:45.164Z" />

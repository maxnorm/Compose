---
sidebar_position: 99
title: "AccessControlTemporalFacet"
description: "Contract documentation for AccessControlTemporalFacet"
---

import DocHero from '@site/src/components/docs/DocHero';
import Callout from '@site/src/components/ui/Callout';


<DocHero
  title="AccessControlTemporalFacet"
  subtitle="Contract documentation for AccessControlTemporalFacet"
  variant="gradient"
  height="small"
/>


## Overview

The AccessControlTemporalFacet implements role-based access control with time-bound permissions, enabling accounts to hold roles that automatically expire after a specified timestamp. This facet is particularly useful in diamond contracts to manage temporary access rights and enforce time-limited privileges effectively.


[View Source](https://github.com/maxnorm/Compose/blob/eabc77b81e461d751a5a8e003c3a9c2e818b9d3c/src/access/AccessControlTemporal/AccessControlTemporalFacet.sol)



<Callout type="info" title="Key Features">
- Supports time-limited role assignments.\n- Provides role validation with automatic expiration checks.\n- Includes admin-controlled revocation of temporal roles.
</Callout>




## Functions


### getAccessControlStorage


Returns the storage for AccessControl.



```solidity
function getAccessControlStorage() internal pure returns (AccessControlStorage storage s);
```




**Returns**

| Name | Type | Description |
|------|------|-------------|

| `s` | `AccessControlStorage` | The AccessControl storage struct. |




### getStorage


Returns the storage for AccessControlTemporal.



```solidity
function getStorage() internal pure returns (AccessControlTemporalStorage storage s);
```




**Returns**

| Name | Type | Description |
|------|------|-------------|

| `s` | `AccessControlTemporalStorage` | The AccessControlTemporal storage struct. |




### getRoleExpiry


Returns the expiry timestamp for a role assignment.



```solidity
function getRoleExpiry(bytes32 _role, address _account) external view returns (uint256);
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_role` | `bytes32` | The role to check. |

| `_account` | `address` | The account to check. |




**Returns**

| Name | Type | Description |
|------|------|-------------|

| `-` | `uint256` | The expiry timestamp, or 0 if no expiry is set. |




### isRoleExpired


Checks if a role assignment has expired.



```solidity
function isRoleExpired(bytes32 _role, address _account) external view returns (bool);
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_role` | `bytes32` | The role to check. |

| `_account` | `address` | The account to check. |




**Returns**

| Name | Type | Description |
|------|------|-------------|

| `-` | `bool` | True if the role has expired or doesn't exist, false if still valid. |




### grantRoleWithExpiry


Grants a role to an account with an expiry timestamp. Only the admin of the role can grant it with expiry. Emits a RoleGrantedWithExpiry event. error: AccessControlUnauthorizedAccount If the caller is not the admin of the role.



```solidity
function grantRoleWithExpiry(bytes32 _role, address _account, uint256 _expiresAt) external;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_role` | `bytes32` | The role to grant. |

| `_account` | `address` | The account to grant the role to. |

| `_expiresAt` | `uint256` | The timestamp when the role should expire (must be in the future). |





### revokeTemporalRole


Revokes a temporal role from an account. Only the admin of the role can revoke it. Emits a TemporalRoleRevoked event. error: AccessControlUnauthorizedAccount If the caller is not the admin of the role.



```solidity
function revokeTemporalRole(bytes32 _role, address _account) external;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_role` | `bytes32` | The role to revoke. |

| `_account` | `address` | The account to revoke the role from. |





### requireValidRole


Checks if an account has a valid (non-expired) role. - error: AccessControlUnauthorizedAccount If the account does not have the role. - error: AccessControlRoleExpired If the role has expired.



```solidity
function requireValidRole(bytes32 _role, address _account) external view;
```



**Parameters**

| Name | Type | Description |
|------|------|-------------|

| `_role` | `bytes32` | The role to check. |

| `_account` | `address` | The account to check the role for. |







## Events


### RoleGrantedWithExpiry


Event emitted when a role is granted with an expiry timestamp.



```solidity
event RoleGrantedWithExpiry(
    bytes32 indexed _role, address indexed _account, uint256 _expiresAt, address indexed _sender
);
```



| Parameter | Type | Description |
|-----------|------|-------------|

| `_role` | `bytes32` | The role that was granted. |

| `_account` | `address` | The account that was granted the role. |

| `_expiresAt` | `uint256` | The timestamp when the role expires. |

| `_sender` | `address` | The account that granted the role. |




### TemporalRoleRevoked


Event emitted when a temporal role is revoked.



```solidity
event TemporalRoleRevoked(bytes32 indexed _role, address indexed _account, address indexed _sender);
```



| Parameter | Type | Description |
|-----------|------|-------------|

| `_role` | `bytes32` | The role that was revoked. |

| `_account` | `address` | The account from which the role was revoked. |

| `_sender` | `address` | The account that revoked the role. |






## Errors


### AccessControlUnauthorizedAccount


Thrown when the account does not have a specific role.



```solidity
error AccessControlUnauthorizedAccount(address _account, bytes32 _role);
```



### AccessControlRoleExpired


Thrown when a role has expired.



```solidity
error AccessControlRoleExpired(bytes32 _role, address _account);
```





## Structs


### AccessControlStorage



```solidity
struct AccessControlStorage {
    mapping(address account =&gt; mapping(bytes32 role =&gt; bool hasRole)) hasRole;
    mapping(bytes32 role =&gt; bytes32 adminRole) adminRole;
}
```



### AccessControlTemporalStorage



```solidity
struct AccessControlTemporalStorage {
    mapping(address account =&gt; mapping(bytes32 role =&gt; uint256 expiryTimestamp)) roleExpiry;
}
```





## Usage Example

```solidity
contract ExampleDiamond {\n    // Declare facet-related storage\n    AccessControlTemporalFacet private accessControlFacet;\n    \n    constructor(address _facetAddress) {\n        // Initialize the facet\n        accessControlFacet = AccessControlTemporalFacet(_facetAddress);\n    }\n    \n    function setupRoleWithExpiry(address _account, bytes32 _role, uint256 _expiryTimestamp) external {\n        // Grant a temporal role\n        accessControlFacet.grantRoleWithExpiry(_role, _account, _expiryTimestamp);\n    }\n    \n    function checkRoleValidity(address _account, bytes32 _role) external view returns (bool) {\n        // Check if the role is valid (non-expired)\n        return !accessControlFacet.isRoleExpired(_account, _role);\n    }\n    \n    function executeRestrictedAction(bytes32 _role) external {\n        // Ensure the sender has a valid role before proceeding\n        accessControlFacet.requireValidRole(msg.sender, _role);\n        // Perform restricted action here\n    }\n}
```



## Best Practices

<Callout type="tip" title="Best Practice">
- Define clear use cases for temporal roles in your system to avoid unnecessary complexity.\n- Use descriptive, unique role identifiers (e.g., `keccak256(abi.encodePacked(..))`) to avoid conflicts.\n- Always emit predictable events (e.g., `RoleGrantedWithExpiry`) for monitoring role changes and expiration handling.
</Callout>




## Security Considerations

<Callout type="warning" title="Security">
Ensure that only intended administrators can call `grantRoleWithExpiry` and `revokeTemporalRole` to maintain control over role assignments. Use reentrancy guards when enforcing temporal role checks within other critical diamond functionality to prevent state manipulation or reentrancy attacks. Always handle errors related to expired roles (`AccessControlRoleExpired`) safely to avoid unauthorized access.
</Callout>






---
sidebar_position: 99
title: "AccessControlTemporalFacet"
description: "Contract documentation for AccessControlTemporalFacet"
gitSource: "https://github.com/maxnorm/Compose/blob/117a9e586e335bd5662e5aba533c315582d9ef9b/src/access/AccessControlTemporal/AccessControlTemporalFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Contract documentation for AccessControlTemporalFacet
</DocSubtitle>

<Callout type="info" title="Key Features">
- Grants roles with precise expiration timestamps, enabling temporary privileges.
- Validation of roles includes both existence and expiration, ensuring time-limited access control.
- Includes admin-only role management with custom error reporting to track access violations.
</Callout>

## Overview

The AccessControlTemporalFacet combines traditional access control mechanisms with time-based restrictions. It allows roles to be assigned to specific accounts with an expiration timestamp, providing fine-grained, temporal access control within a Compose diamond.

---

## Storage

### AccessControlStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct AccessControlStorage {
    mapping(address account => mapping(bytes32 role => bool hasRole)) hasRole;
    mapping(bytes32 role => bytes32 adminRole) adminRole;
}`}
</ExpandableCode>

---
### AccessControlTemporalStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct AccessControlTemporalStorage {
    mapping(address account => mapping(bytes32 role => uint256 expiryTimestamp)) roleExpiry;
}`}
</ExpandableCode>

---
### State Variables

<PropertyTable
  properties={[
    {
      name: "ACCESS_CONTROL_STORAGE_POSITION",
      type: "constant",
      description: ""
    },
    {
      name: "TEMPORAL_STORAGE_POSITION",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### getAccessControlStorage

Returns the storage for AccessControl.

<ExpandableCode language="solidity" maxLines={8}>
{`function getAccessControlStorage() internal pure returns (AccessControlStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "AccessControlStorage",
      description: "The AccessControl storage struct."
    }
  ]}
  showRequired={false}
/>

---
### getStorage

Returns the storage for AccessControlTemporal.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (AccessControlTemporalStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "AccessControlTemporalStorage",
      description: "The AccessControlTemporal storage struct."
    }
  ]}
  showRequired={false}
/>

---
### getRoleExpiry

Returns the expiry timestamp for a role assignment.

<ExpandableCode language="solidity" maxLines={8}>
{`function getRoleExpiry(bytes32 _role, address _account) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The expiry timestamp, or 0 if no expiry is set."
    }
  ]}
  showRequired={false}
/>

---
### isRoleExpired

Checks if a role assignment has expired.

<ExpandableCode language="solidity" maxLines={8}>
{`function isRoleExpired(bytes32 _role, address _account) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the role has expired or doesn\&#x27;t exist, false if still valid."
    }
  ]}
  showRequired={false}
/>

---
### grantRoleWithExpiry

Grants a role to an account with an expiry timestamp. Only the admin of the role can grant it with expiry. Emits a RoleGrantedWithExpiry event. error: AccessControlUnauthorizedAccount If the caller is not the admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function grantRoleWithExpiry(bytes32 _role, address _account, uint256 _expiresAt) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to grant."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to grant the role to."
    },
    {
      name: "_expiresAt",
      type: "uint256",
      description: "The timestamp when the role should expire (must be in the future)."
    }
  ]}
  showRequired={false}
/>

---
### revokeTemporalRole

Revokes a temporal role from an account. Only the admin of the role can revoke it. Emits a TemporalRoleRevoked event. error: AccessControlUnauthorizedAccount If the caller is not the admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function revokeTemporalRole(bytes32 _role, address _account) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to revoke."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to revoke the role from."
    }
  ]}
  showRequired={false}
/>

---
### requireValidRole

Checks if an account has a valid (non-expired) role. - error: AccessControlUnauthorizedAccount If the account does not have the role. - error: AccessControlRoleExpired If the role has expired.

<ExpandableCode language="solidity" maxLines={8}>
{`function requireValidRole(bytes32 _role, address _account) external view;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check the role for."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="RoleGrantedWithExpiry" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Event emitted when a role is granted with an expiry timestamp.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleGrantedWithExpiry(
    bytes32 indexed _role, address indexed _account, uint256 _expiresAt, address indexed _sender
);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was granted."
          },
          {
            name: "_account",
            type: "address",
            description: "The account that was granted the role."
          },
          {
            name: "_expiresAt",
            type: "uint256",
            description: "The timestamp when the role expires."
          },
          {
            name: "_sender",
            type: "address",
            description: "The account that granted the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="TemporalRoleRevoked" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Event emitted when a temporal role is revoked.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event TemporalRoleRevoked(bytes32 indexed _role, address indexed _account, address indexed _sender);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was revoked."
          },
          {
            name: "_account",
            type: "address",
            description: "The account from which the role was revoked."
          },
          {
            name: "_sender",
            type: "address",
            description: "The account that revoked the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="AccessControlUnauthorizedAccount" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the account does not have a specific role.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlUnauthorizedAccount(address _account, bytes32 _role);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="AccessControlRoleExpired" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when a role has expired.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlRoleExpired(bytes32 _role, address _account);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import { IDiamondCut } from "lib/diamond/contracts/interfaces/IDiamondCut.sol";
import { AccessControlTemporalFacet } from "./facets/AccessControlTemporalFacet.sol";

contract AccessControlDemo {
    IDiamondCut private diamondCut;

    function setupAccessControlFacet(address diamondAddress, address admin) external {
        diamondCut = IDiamondCut(diamondAddress);

        // Add AccessControlTemporalFacet
        IDiamondCut.FacetCut[] memory cut = new IDiamondCut.FacetCut[](1);
        cut[0] = IDiamondCut.FacetCut({
            facetAddress: address(new AccessControlTemporalFacet()),
            action: IDiamondCut.FacetCutAction.Add,
            functionSelectors: abi.encodePacked(
                AccessControlTemporalFacet.getAccessControlStorage.selector,
                AccessControlTemporalFacet.getStorage.selector,
                AccessControlTemporalFacet.getRoleExpiry.selector,
                AccessControlTemporalFacet.isRoleExpired.selector,
                AccessControlTemporalFacet.grantRoleWithExpiry.selector,
                AccessControlTemporalFacet.revokeTemporalRole.selector,
                AccessControlTemporalFacet.requireValidRole.selector
            )
        });

        diamondCut.diamondCut(cut, address(0), "");

        // Grant admin role
        AccessControlTemporalFacet(diamondAddress).grantRoleWithExpiry(
            keccak256("ADMIN_ROLE"), admin, type(uint256).max
        );
    }

    function checkAccess(address diamondAddress, address account, bytes32 role) external view returns (bool) {
        return !AccessControlTemporalFacet(diamondAddress).isRoleExpired(role, account);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure AccessControlTemporalFacet is one of the first facets initialized, and properly initialize roles to admins if needed.
- Use clear and well-defined role constants (e.g., &#x60;keccak256(&quot;ROLE_NAME&quot;)&#x60;) to avoid collisions between diamonds or systems.
- Verify that the time-related logic is consistent with system requirements; test for scenarios like time zone discrepancies and expiry precision.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Ensure role management functions (e.g., &#x60;grantRoleWithExpiry&#x60; and &#x60;revokeTemporalRole&#x60;) are restricted to authorized administrators. Validate that expiry logic considers system time drift risks. Avoid reentrancy vulnerabilities by minimizing reliance on external calls within functions and ensuring proper controls are in place for recursive scenarios.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="AccessControlTemporalFacet" />
</div>

<LastUpdated date="2025-12-15T20:55:08.792Z" />

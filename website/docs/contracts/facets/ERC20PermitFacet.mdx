---
sidebar_position: 99
title: "ERC20PermitFacet"
description: "Contract documentation for ERC20PermitFacet"
---

import DocHero from '@site/src/components/docs/DocHero';
import Callout from '@site/src/components/ui/Callout';
import PropertyTable from '@site/src/components/api/PropertyTable';

<DocHero
  title="ERC20PermitFacet"
  subtitle="Contract documentation for ERC20PermitFacet"
  variant="gradient"
  height="small"
/>

## Overview

The ERC20PermitFacet adds EIP-2612 permit functionality to an ERC-20 token implementation within a diamond proxy. It allows token holders to set allowances for spenders using off-chain signatures instead of on-chain transactions, saving gas and making interaction more efficient for users.

[View Source](https://github.com/maxnorm/Compose/blob/bd92d896acdf08abd003a5846f267d6de9578ab5/src/token/ERC20/ERC20Permit/ERC20PermitFacet.sol)

<Callout type="info" title="Key Features">
- Implements EIP-2612, enabling gasless token allowance updates via off-chain signatures.\n- Integrates seamlessly as a facet of a diamond proxy architecture.
</Callout>

## Structs

### ERC20Storage

```solidity
struct ERC20Storage {
    mapping(address owner &#x3D;&gt; uint256 balance) balanceOf;
    uint256 totalSupply;
    mapping(address owner &#x3D;&gt; mapping(address spender &#x3D;&gt; uint256 allowance)) allowance;
    uint8 decimals;
    string name;
}
```

### ERC20PermitStorage

```solidity
struct ERC20PermitStorage {
    mapping(address owner &#x3D;&gt; uint256) nonces;
}
```

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "ERC20_STORAGE_POSITION",
      type: "constant",
      description: ""
    },
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### getERC20Storage

```solidity
function getERC20Storage() internal pure returns (ERC20Storage storage s);
```

### getStorage

```solidity
function getStorage() internal pure returns (ERC20PermitStorage storage s);
```

### nonces

Returns the current nonce for an owner. This value changes each time a permit is used.

```solidity
function nonces(address _owner) external view returns (uint256);
```

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address of the owner."
    }
  ]}
  showRequired={false}
/>

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The current nonce."
    }
  ]}
  showRequired={false}
/>

### DOMAIN_SEPARATOR

Returns the domain separator used in the encoding of the signature for permit. This value is unique to a contract and chain ID combination to prevent replay attacks.

```solidity
function DOMAIN_SEPARATOR() external view returns (bytes32);
```

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bytes32",
      description: "The domain separator."
    }
  ]}
  showRequired={false}
/>

### permit

Sets the allowance for a spender via a signature. This function implements EIP-2612 permit functionality.

```solidity
function permit(
    address _owner,
    address _spender,
    uint256 _value,
    uint256 _deadline,
    uint8 _v,
    bytes32 _r,
    bytes32 _s
) external;
```

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address of the token owner."
    },
    {
      name: "_spender",
      type: "address",
      description: "The address of the spender."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The amount of tokens to approve."
    },
    {
      name: "_deadline",
      type: "uint256",
      description: "The deadline for the permit (timestamp)."
    },
    {
      name: "_v",
      type: "uint8",
      description: "The recovery byte of the signature."
    },
    {
      name: "_r",
      type: "bytes32",
      description: "The r value of the signature."
    },
    {
      name: "_s",
      type: "bytes32",
      description: "The s value of the signature."
    }
  ]}
  showRequired={false}
/>

## Events

### Approval

Emitted when an approval is made for a spender by an owner.

```solidity
event Approval(address indexed _owner, address indexed _spender, uint256 _value);
```

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address granting the allowance."
    },
    {
      name: "_spender",
      type: "address",
      description: "The address receiving the allowance."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The amount approved."
    }
  ]}
  showRequired={false}
/>

## Errors

### ERC2612InvalidSignature

Thrown when a permit signature is invalid or expired.

```solidity
error ERC2612InvalidSignature(
    address _owner, address _spender, uint256 _value, uint256 _deadline, uint8 _v, bytes32 _r, bytes32 _s
);
```

### ERC20InvalidSpender

Thrown when the spender address is invalid (e.g., zero address).

```solidity
error ERC20InvalidSpender(address _spender);
```

## Usage Example

```solidity
pragma solidity ^0.8.0;\n\nimport { Diamond } from &#x27;path/to/Diamond.sol&#x27;;\n\ncontract MyTokenDiamond {\n    // Assume this contract uses diamond proxy libraries and setup\n    function permitSpender(address owner, address spender, uint256 value, uint256 deadline, uint8 v, bytes32 r, bytes32 s) external {\n        Diamond.diamondCut(/* Add ERC20PermitFacet to diamond */);\n        ERC20PermitFacet(address(this)).permit(owner, spender, value, deadline, v, r, s);\n    }\n\n    function checkDomainSeparator() external view returns (bytes32) {\n        return ERC20PermitFacet(address(this)).DOMAIN_SEPARATOR();\n    }\n\n    function getNonce(address owner) external view returns (uint256) {\n        return ERC20PermitFacet(address(this)).nonces(owner);\n    }\n}
```

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure the facet is fully tested with different chain IDs to validate DOMAIN_SEPARATOR integrity.\n- Use this facet only in environments where the off-chain signature data can remain secure.\n- Properly initialize storage for EIP-2612 (e.g., domain separator) during deployment or upgrades.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Ensure proper validation of the signature&#x27;s parameters to prevent replay attacks or unauthorized transactions. Avoid using this facet in scenarios where signature data can be intercepted or manipulated. Make sure to verify and initialize the DOMAIN_SEPARATOR for the correct chain ID before usage.
</Callout>

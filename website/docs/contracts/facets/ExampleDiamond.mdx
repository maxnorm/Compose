---
sidebar_position: 99
title: "ExampleDiamond"
description: "Contract documentation for ExampleDiamond"
gitSource: "https://github.com/maxnorm/Compose/blob/326d9e4b8d8f7ef437a77f59f91bb1619c2d1a6c/src/diamond/example/ExampleDiamond.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Contract documentation for ExampleDiamond
</DocSubtitle>

<Callout type="info" title="Key Features">
- Dynamically routes calls to appropriate facets based on function selector mappings.
- Robust initialization via &#x60;constructor&#x60; for setting up facets and contract owner.
- Support for fallback and receive functions to enhance interaction capabilities.
</Callout>

## Overview

The &#x60;ExampleDiamond&#x60; is a foundational contract for deploying and managing a diamond proxy according to the EIP-2535 standard. It initializes the diamond with owner information, orchestrates facets, and facilitates function routing through dynamically allocated function selectors.

---

## Storage

## Functions

### constructor

Struct to hold facet address and its function selectors. struct FacetCut &amp;#123; address facetAddress; FacetCutAction action; // Add&#x3D;0, Replace&#x3D;1, Remove&#x3D;2 bytes4[] functionSelectors; &amp;#125; Initializes the diamond contract with facets, owner and other data. Adds all provided facets to the diamond&#x27;s function selector mapping and sets the contract owner. Each facet in the array will have its function selectors registered to enable delegatecall routing.

<ExpandableCode language="solidity" maxLines={8}>
{`constructor(DiamondMod.FacetCut[] memory _facets, address _diamondOwner) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_facets",
      type: "DiamondMod.FacetCut[]",
      description: "Array of facet addresses and their corresponding function selectors to add to the diamond."
    },
    {
      name: "_diamondOwner",
      type: "address",
      description: "Address that will be set as the owner of the diamond contract."
    }
  ]}
  showRequired={false}
/>

---
### fallback

<ExpandableCode language="solidity" maxLines={8}>
{`fallback() external payable;`}
</ExpandableCode>

---
### receive

<ExpandableCode language="solidity" maxLines={8}>
{`receive() external payable;`}
</ExpandableCode>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

contract ExampleConsumer {
    ExampleDiamond private diamond;

    constructor(address diamondAddress) {
        diamond = ExampleDiamond(diamondAddress);
    }

    function addFacet(address _facetAddress, bytes4[] calldata _selectors) external {
        ExampleDiamond.FacetCut[] memory facets = new ExampleDiamond.FacetCut[](1);
        facets[0] = ExampleDiamond.FacetCut({
            facetAddress: _facetAddress,
            action: 0, // Add action
            functionSelectors: _selectors
        });
        diamond.diamondCut(facets, address(0), "");
    }

    function executeFallback() external payable {
        (bool success,) = address(diamond).call{value: msg.value}(msg.data);
        require(success, "Fallback execution failed");
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure the &#x60;constructor&#x60; correctly adds all required facets covering the diamond&#x27;s desired functionality.
- Verify function selector conflicts across facets before including them to prevent overwrites.
- Utilize off-chain tools or analyses to maintain a secure and upgradable diamond architecture.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Ensure only authorized actions during initialization and runtime, particularly around &#x60;diamondCut&#x60;. Validate facet integrity and function selectors for conflicts or overlapped logic. Avoid reentrancy issues in fallback or receive methods.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ExampleDiamond" />
</div>

<LastUpdated date="2025-12-15T21:50:32.481Z" />

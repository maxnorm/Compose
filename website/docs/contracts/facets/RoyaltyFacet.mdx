---
sidebar_position: 99
title: "RoyaltyFacet"
description: "**Title:**"
gitSource: "https://github.com/maxnorm/Compose/blob/326d9e4b8d8f7ef437a77f59f91bb1619c2d1a6c/src/token/Royalty/RoyaltyFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
**Title:**
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements ERC-2981 for standardized royalty calculation.
- Supports token-level and default royalty management, fallback behavior ensures predictable logic.
</Callout>

## Overview

The RoyaltyFacet provides royalty calculation and storage access within a Compose diamond. It implements ERC-2981 to standardize royalty calculations for tokens, ensuring token creators can receive a percentage of secondary sales. It manages both default and token-specific royalty configurations.

---

## Storage

### RoyaltyInfo

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyInfo {
    address receiver;
    uint96 royaltyFraction;
}`}
</ExpandableCode>

---
### RoyaltyStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyStorage {
    RoyaltyInfo defaultRoyaltyInfo;
    mapping(uint256 tokenId => RoyaltyInfo) tokenRoyaltyInfo;
}`}
</ExpandableCode>

---
### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: ""
    },
    {
      name: "FEE_DENOMINATOR",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the royalty storage struct. Uses inline assembly to access the storage slot defined by STORAGE_POSITION.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (RoyaltyStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "RoyaltyStorage",
      description: "The RoyaltyStorage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### royaltyInfo

Returns royalty information for a given token and sale price. Returns token-specific royalty if set, otherwise falls back to default royalty. Royalty amount is calculated as a percentage of the sale price using basis points. Implements the ERC-2981 royaltyInfo function.

<ExpandableCode language="solidity" maxLines={8}>
{`function royaltyInfo(uint256 _tokenId, uint256 _salePrice)
    external
    view
    returns (address receiver, uint256 royaltyAmount);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The NFT asset queried for royalty information."
    },
    {
      name: "_salePrice",
      type: "uint256",
      description: "The sale price of the NFT asset specified by _tokenId."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "receiver",
      type: "address",
      description: "The address designated to receive the royalty payment."
    },
    {
      name: "royaltyAmount",
      type: "uint256",
      description: "The royalty payment amount for _salePrice."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import { RoyaltyFacet } from "./RoyaltyFacet.sol";

contract Diamond {
    RoyaltyFacet private royaltyFacet;

    constructor(address _royaltyFacetAddress) {
        royaltyFacet = RoyaltyFacet(_royaltyFacetAddress);
    }

    function getRoyaltyInfo(uint256 tokenId, uint256 salePrice) external view returns (address receiver, uint256 amount) {
        return royaltyFacet.royaltyInfo(tokenId, salePrice);
    }

    function getRoyaltyStorageDetails() external view returns (RoyaltyStorage.Struct memory) {
        return royaltyFacet.getStorage();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure proper initialization of default royalty parameters before deployment.
- Restrict write access to royalty configurations to authorized parties, preventing unauthorized changes.
- Test both default and token-specific royalty setups to confirm expected behavior during upgrades.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Restrict modification to default and per-token royalty settings to avoid unauthorized changes. Validate royalty percentages to prevent setting excessive or invalid values through input sanitization. Inline assembly in getStorage demands careful review to avoid unintended access or corruption of unrelated storage slots.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="RoyaltyFacet" />
</div>

<LastUpdated date="2025-12-15T21:49:52.168Z" />

---
sidebar_position: 2
title: "ERC721Facet"
description: "Manages ERC-721 token ownership, transfers, and approvals."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/token/ERC721/ERC721/ERC721Facet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manages ERC-721 token ownership, transfers, and approvals.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements core ERC-721 functionalities including ownership, approvals, and transfers.
- Supports metadata retrieval via `tokenURI`.
- Includes safe transfer mechanisms to ensure receiver compatibility.
</Callout>

## Overview

The ERC721Facet provides standard ERC-721 functionality for non-fungible tokens within a Compose diamond. It handles token metadata, ownership tracking, and approval mechanisms, enabling composable NFT contracts.

---

## Storage

### ERC721Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC721Storage {
    mapping(uint256 tokenId => address owner) ownerOf;
    mapping(address owner => uint256 balance) balanceOf;
    mapping(address owner => mapping(address operator => bool approved)) isApprovedForAll;
    mapping(uint256 tokenId => address approved) approved;
    string name;
    string symbol;
    string baseURI;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc721\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### name

Returns the token collection name.

<ExpandableCode language="solidity" maxLines={8}>
{`function name() external view returns (string memory);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The name of the token collection."
    }
  ]}
  showRequired={false}
/>

---
### symbol

Returns the token collection symbol.

<ExpandableCode language="solidity" maxLines={8}>
{`function symbol() external view returns (string memory);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The symbol of the token collection."
    }
  ]}
  showRequired={false}
/>

---
### tokenURI

Provide the metadata URI for a given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function tokenURI(uint256 _tokenId) external view returns (string memory);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "tokenID of the NFT to query the metadata from"
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "the URI providing the detailed metadata of the specified tokenID"
    }
  ]}
  showRequired={false}
/>

---
### balanceOf

Returns the number of tokens owned by a given address.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOf(address _owner) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address to query the balance of."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The balance (number of tokens) owned by `_owner`."
    }
  ]}
  showRequired={false}
/>

---
### ownerOf

Returns the owner of a given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function ownerOf(uint256 _tokenId) public view returns (address);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "address",
      description: "The address of the token owner."
    }
  ]}
  showRequired={false}
/>

---
### getApproved

Returns the approved address for a given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function getApproved(uint256 _tokenId) external view returns (address);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to query the approval of."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "address",
      description: "The approved address for the token."
    }
  ]}
  showRequired={false}
/>

---
### isApprovedForAll

Returns true if an operator is approved to manage all of an owner's assets.

<ExpandableCode language="solidity" maxLines={8}>
{`function isApprovedForAll(address _owner, address _operator) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The token owner."
    },
    {
      name: "_operator",
      type: "address",
      description: "The operator address."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the operator is approved for all tokens of the owner."
    }
  ]}
  showRequired={false}
/>

---
### approve

Approves another address to transfer the given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function approve(address _to, uint256 _tokenId) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_to",
      type: "address",
      description: "The address to be approved."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to approve."
    }
  ]}
  showRequired={false}
/>

---
### setApprovalForAll

Approves or revokes permission for an operator to manage all caller's assets.

<ExpandableCode language="solidity" maxLines={8}>
{`function setApprovalForAll(address _operator, bool _approved) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_operator",
      type: "address",
      description: "The operator address to set approval for."
    },
    {
      name: "_approved",
      type: "bool",
      description: "True to approve, false to revoke."
    }
  ]}
  showRequired={false}
/>

---
### transferFrom

Transfers a token from one address to another.

<ExpandableCode language="solidity" maxLines={8}>
{`function transferFrom(address _from, address _to, uint256 _tokenId) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    }
  ]}
  showRequired={false}
/>

---
### safeTransferFrom

Safely transfers a token, checking if the receiver can handle ERC-721 tokens.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeTransferFrom(address _from, address _to, uint256 _tokenId) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    }
  ]}
  showRequired={false}
/>

---
### safeTransferFrom

Safely transfers a token with additional data.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeTransferFrom(address _from, address _to, uint256 _tokenId, bytes calldata _data) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    },
    {
      name: "_data",
      type: "bytes",
      description: "Additional data with no specified format."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="Transfer" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="Approval" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Approval(address indexed _owner, address indexed _to, uint256 indexed _tokenId);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="ApprovalForAll" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event ApprovalForAll(address indexed _owner, address indexed _operator, bool _approved);`}
      </ExpandableCode>
    </div>

  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC721InvalidOwner" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidOwner(address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721NonexistentToken" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721NonexistentToken(uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721IncorrectOwner" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721IncorrectOwner(address _sender, uint256 _tokenId, address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidSender" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidReceiver" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InsufficientApproval" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InsufficientApproval(address _operator, uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidApprover" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidApprover(address _approver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidOperator" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidOperator(address _operator);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {DiamondDeploy} from "@compose/diamond/DiamondDeploy.sol";
import {ERC721Facet} from "@compose/token/ERC721/ERC721/ERC721Facet.sol";
import {IERC721} from "@compose/token/ERC721/IERC721.sol";

contract MyNFtDiamond is DiamondDeploy {
    function deploy() public {
        address[] memory facets = new address[](1);
        facets[0] = address(new ERC721Facet());

        deployDiamond("MyNFTDiamond", facets);
    }

    function mintToken(address _to, uint256 _tokenId) public {
        // Assuming minting logic is handled by another facet or external contract
        // For demonstration, we'll call a hypothetical internal function if it existed
        // In a real scenario, you'd interact with a facet that has minting capabilities.
    }

    function getTokenOwner(uint256 _tokenId) public view returns (address) {
        ERC721Facet erc721Facet = ERC721Facet(address(this));
        return erc721Facet.ownerOf(_tokenId);
    }

    function getTokenURI(uint256 _tokenId) public view returns (string memory) {
        ERC721Facet erc721Facet = ERC721Facet(address(this));
        return erc721Facet.tokenURI(_tokenId);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the ERC721Facet with a unique storage slot using `STORAGE_POSITION`.
- Integrate with other facets for minting and burning functionalities, ensuring proper access control.
- Use `internalTransferFrom` for internal state transitions and public transfer functions for external interactions.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Ensure that access control for minting and burning is handled by a separate, appropriately secured facet. Validate all input parameters for token IDs and addresses to prevent unintended state changes or denial-of-service attacks. Be mindful of reentrancy risks if other facets interact with this facet during transfer operations.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <RelatedDocs
    items={[
      {
        title: "ERC721Mod",
        href: "/docs/library/token/ERC721/ERC721/ERC721Mod",
        description: "Module used by ERC721Facet",
        icon: "ðŸ“¦"
      },
      {
        title: "ERC20PermitFacet",
        href: "/docs/library/token/ERC20/ERC20Permit/ERC20PermitFacet",
        description: "Related facet in token",
        icon: "ðŸ’Ž"
      },
      {
        title: "ERC20Facet",
        href: "/docs/library/token/ERC20/ERC20/ERC20Facet",
        description: "Related facet in token",
        icon: "ðŸ’Ž"
      },
      {
        title: "ERC20BurnFacet",
        href: "/docs/library/token/ERC20/ERC20/ERC20BurnFacet",
        description: "Related facet in token",
        icon: "ðŸ’Ž"
      },
      {
        title: "ERC20BridgeableFacet",
        href: "/docs/library/token/ERC20/ERC20Bridgeable/ERC20BridgeableFacet",
        description: "Related facet in token",
        icon: "ðŸ’Ž"
      },
      {
        title: "ERC1155Facet",
        href: "/docs/library/token/ERC1155/ERC1155Facet",
        description: "Related facet in token",
        icon: "ðŸ’Ž"
      }
    ]}
  />
</div>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC721Facet" />
</div>

<LastUpdated date="2025-12-30T17:10:43.388Z" />

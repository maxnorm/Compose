---
sidebar_position: 99
title: "ERC20Facet"
description: "Standard ERC-20 token functionality for Compose diamonds."
gitSource: "https://github.com/maxnorm/Compose/blob/7e2dd824639f424be644c4ebbb3ca2508167329f/src/token/ERC20/ERC20/ERC20Facet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Standard ERC-20 token functionality for Compose diamonds.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements all standard ERC-20 functions: name, symbol, decimals, totalSupply, balanceOf, allowance, approve, transfer, and transferFrom.
- Integrates seamlessly with the Compose diamond proxy pattern and its storage management.
- Emits standard ERC-20 events (Approval, Transfer) for off-chain monitoring and indexing.
</Callout>

## Overview

The ERC20Facet provides a complete implementation of the ERC-20 token standard, enabling fungible token operations within a Compose diamond. It exposes standard functions for querying token details, managing balances, and handling approvals and transfers, all integrated with the diamond's storage pattern.

---

## Storage

### ERC20Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC20Storage {
    mapping(address owner => uint256 balance) balanceOf;
    uint256 totalSupply;
    mapping(address owner => mapping(address spender => uint256 allowance)) allowance;
    uint8 decimals;
    string name;
    string symbol;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: "Diamond storage slot position for this module"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns the ERC20 storage struct from the predefined diamond storage slot. Uses inline assembly to set the storage slot reference.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (ERC20Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC20Storage",
      description: "The ERC20 storage struct reference."
    }
  ]}
  showRequired={false}
/>

---
### name

Returns the name of the token.

<ExpandableCode language="solidity" maxLines={8}>
{`function name() external view returns (string memory);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The token name."
    }
  ]}
  showRequired={false}
/>

---
### symbol

Returns the symbol of the token.

<ExpandableCode language="solidity" maxLines={8}>
{`function symbol() external view returns (string memory);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The token symbol."
    }
  ]}
  showRequired={false}
/>

---
### decimals

Returns the number of decimals used for token precision.

<ExpandableCode language="solidity" maxLines={8}>
{`function decimals() external view returns (uint8);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint8",
      description: "The number of decimals."
    }
  ]}
  showRequired={false}
/>

---
### totalSupply

Returns the total supply of tokens.

<ExpandableCode language="solidity" maxLines={8}>
{`function totalSupply() external view returns (uint256);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The total token supply."
    }
  ]}
  showRequired={false}
/>

---
### balanceOf

Returns the balance of a specific account.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOf(address _account) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_account",
      type: "address",
      description: "The address of the account."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The account balance."
    }
  ]}
  showRequired={false}
/>

---
### allowance

Returns the remaining number of tokens that a spender is allowed to spend on behalf of an owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function allowance(address _owner, address _spender) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address of the token owner."
    },
    {
      name: "_spender",
      type: "address",
      description: "The address of the spender."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The remaining allowance."
    }
  ]}
  showRequired={false}
/>

---
### approve

Approves a spender to transfer up to a certain amount of tokens on behalf of the caller. Emits an Approval event.

<ExpandableCode language="solidity" maxLines={8}>
{`function approve(address _spender, uint256 _value) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_spender",
      type: "address",
      description: "The address approved to spend tokens."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The number of tokens to approve."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the approval was successful."
    }
  ]}
  showRequired={false}
/>

---
### transfer

Transfers tokens to another address. Emits a Transfer event.

<ExpandableCode language="solidity" maxLines={8}>
{`function transfer(address _to, uint256 _value) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_to",
      type: "address",
      description: "The address to receive the tokens."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The amount of tokens to transfer."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the transfer was successful."
    }
  ]}
  showRequired={false}
/>

---
### transferFrom

Transfers tokens on behalf of another account, provided sufficient allowance exists. Emits a Transfer event and decreases the spender's allowance.

<ExpandableCode language="solidity" maxLines={8}>
{`function transferFrom(address _from, address _to, uint256 _value) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The address to transfer tokens from."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to transfer tokens to."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The amount of tokens to transfer."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the transfer was successful."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="Approval" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when an approval is made for a spender by an owner.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Approval(address indexed _owner, address indexed _spender, uint256 _value);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_owner",
            type: "address",
            description: "The address granting the allowance."
          },
          {
            name: "_spender",
            type: "address",
            description: "The address receiving the allowance."
          },
          {
            name: "_value",
            type: "uint256",
            description: "The amount approved."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="Transfer" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when tokens are transferred between two addresses.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Transfer(address indexed _from, address indexed _to, uint256 _value);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_from",
            type: "address",
            description: "Address sending the tokens."
          },
          {
            name: "_to",
            type: "address",
            description: "Address receiving the tokens."
          },
          {
            name: "_value",
            type: "uint256",
            description: "Amount of tokens transferred."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC20InsufficientBalance" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when an account has insufficient balance for a transfer or burn.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC20InsufficientBalance(address _sender, uint256 _balance, uint256 _needed);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC20InvalidSender" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the sender address is invalid (e.g., zero address).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC20InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC20InvalidReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the receiver address is invalid (e.g., zero address).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC20InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC20InsufficientAllowance" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when a spender tries to use more than the approved allowance.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC20InsufficientAllowance(address _spender, uint256 _allowance, uint256 _needed);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC20InvalidSpender" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the spender address is invalid (e.g., zero address).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC20InvalidSpender(address _spender);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IERC20Facet} from "@compose-protocol/diamond/contracts/facets/erc20/IERC20Facet.sol";
import {IDiamondCuttable} from "@compose-protocol/diamond/contracts/IDiamondCuttable.sol";

contract ERC20Consumer {
    IERC20Facet public erc20Facet;

    function setERC20Facet(address _diamondAddress) external {
        // Assuming the ERC20Facet is at a known facet address in the diamond
        erc20Facet = IERC20Facet(_diamondAddress);
    }

    function getTokenName() external view returns (string memory) {
        return erc20Facet.name();
    }

    function getTokenBalance(address _account) external view returns (uint256) {
        return erc20Facet.balanceOf(_account);
    }

    function approveToken(address _spender, uint256 _amount) external {
        erc20Facet.approve(_spender, _amount);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure the ERC20Facet is properly initialized with the correct token name, symbol, and decimals during diamond deployment or upgrade.
- Leverage the `approve` function carefully, approving only necessary amounts to mitigate risks associated with `transferFrom`.
- Access the facet's storage via the `getStorage` function for direct access to the ERC-20 state variables when needed, ensuring correct slot usage.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Input validation is crucial for all transfer and approval functions to prevent invalid addresses or amounts. Ensure sufficient allowance exists before calling `transferFrom`. The `approve` function should be used with caution to avoid granting excessive spending power. Reentrancy is mitigated by the diamond proxy's architecture, but external calls within facet logic (if any were added) would require careful review.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC20Facet" />
</div>

<LastUpdated date="2025-12-21T21:54:01.130Z" />

---
sidebar_position: 1
title: "AccessControlMod"
description: "Role-based access control for diamond contracts"
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/access/AccessControl/AccessControlMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Role-based access control for diamond contracts
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides internal functions for role management (`grantRole`, `revokeRole`, `hasRole`).
- Utilizes the diamond storage pattern for shared state across facets.
- Reverts with `AccessControlUnauthorizedAccount` error when role checks fail using `requireRole`.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module provides internal functions for managing role-based access control within a diamond. Facets can import and utilize these functions to enforce permissions, ensuring that only authorized accounts can perform specific actions. All access control state is managed through shared diamond storage, making changes immediately visible across all interacting facets.

---

## Storage

### AccessControlStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct AccessControlStorage {
    mapping(address account => mapping(bytes32 role => bool hasRole)) hasRole;
    mapping(bytes32 role => bytes32 adminRole) adminRole;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.accesscontrol\")`)"
    },
    {
      name: "DEFAULT_ADMIN_ROLE",
      type: "bytes32",
      description: "Default administrative role identifier (bytes32(0)) (Value: `0x00`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns the storage for the AccessControl.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (AccessControlStorage storage _s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "_s",
      type: "AccessControlStorage",
      description: "The storage for the AccessControl."
    }
  ]}
  showRequired={false}
/>

---
### grantRole

function to grant a role to an account.

<ExpandableCode language="solidity" maxLines={8}>
{`function grantRole(bytes32 _role, address _account) returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to grant."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to grant the role to."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the role was granted, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### hasRole

function to check if an account has a role.

<ExpandableCode language="solidity" maxLines={8}>
{`function hasRole(bytes32 _role, address _account) view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check the role for."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the account has the role, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### requireRole

function to check if an account has a required role. Reverts with AccessControlUnauthorizedAccount If the account does not have the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function requireRole(bytes32 _role, address _account) view;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to assert."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to assert the role for."
    }
  ]}
  showRequired={false}
/>

---
### revokeRole

function to revoke a role from an account.

<ExpandableCode language="solidity" maxLines={8}>
{`function revokeRole(bytes32 _role, address _account) returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to revoke."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to revoke the role from."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the role was revoked, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### setRoleAdmin

function to set the admin role for a role.

<ExpandableCode language="solidity" maxLines={8}>
{`function setRoleAdmin(bytes32 _role, bytes32 _adminRole) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to set the admin for."
    },
    {
      name: "_adminRole",
      type: "bytes32",
      description: "The admin role to set."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="RoleAdminChanged" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when the admin role for a role is changed.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleAdminChanged(bytes32 indexed _role, bytes32 indexed _previousAdminRole, bytes32 indexed _newAdminRole);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was changed."
          },
          {
            name: "_previousAdminRole",
            type: "bytes32",
            description: "The previous admin role."
          },
          {
            name: "_newAdminRole",
            type: "bytes32",
            description: "The new admin role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="RoleGranted" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when a role is granted to an account.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleGranted(bytes32 indexed _role, address indexed _account, address indexed _sender);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was granted."
          },
          {
            name: "_account",
            type: "address",
            description: "The account that was granted the role."
          },
          {
            name: "_sender",
            type: "address",
            description: "The sender that granted the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="RoleRevoked" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when a role is revoked from an account.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleRevoked(bytes32 indexed _role, address indexed _account, address indexed _sender);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was revoked."
          },
          {
            name: "_account",
            type: "address",
            description: "The account from which the role was revoked."
          },
          {
            name: "_sender",
            type: "address",
            description: "The account that revoked the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="AccessControlUnauthorizedAccount" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the account does not have a specific role.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlUnauthorizedAccount(address _account, bytes32 _role);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

<!-- Usage Example section commented out for now -->
<!--
## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity >=0.8.30;

import @compose/access/AccessControl/AccessControlMod;

contract MyAccessControlFacet {
    AccessControlMod internal accessControl;

    // Assume storage is initialized elsewhere and AccessControlMod is set up.
    // For example:
    // constructor(address _diamondAddress) {
    //     accessControl = AccessControlMod(_diamondAddress);
    // }

    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");

    /**
     * @notice Grants the MINTER_ROLE to an account.
     * @param _account The address to grant the role to.
     * @return True if the role was granted, false otherwise.
     */
    function grantMinterRole(address _account) external returns (bool) {
        // Ensure the caller has the authority to grant this role (e.g., role admin)
        // accessControl.requireRole(accessControl.getRoleAdmin(MINTER_ROLE), msg.sender);

        return accessControl.grantRole(MINTER_ROLE, _account);
    }

    /**
     * @notice Checks if an account has the MINTER_ROLE.
     * @param _account The address to check.
     * @return True if the account has the role, false otherwise.
     */
    function hasMinterRole(address _account) external view returns (bool) {
        return accessControl.hasRole(MINTER_ROLE, _account);
    }

    /**
     * @notice Revokes the MINTER_ROLE from an account.
     * @param _account The address to revoke the role from.
     * @return True if the role was revoked, false otherwise.
     */
    function revokeMinterRole(address _account) external returns (bool) {
        // Ensure the caller has the authority to revoke this role
        // accessControl.requireRole(accessControl.getRoleAdmin(MINTER_ROLE), msg.sender);

        return accessControl.revokeRole(MINTER_ROLE, _account);
    }
}`}
</ExpandableCode>
-->

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure all functions requiring specific permissions call `requireRole` or `hasRole` before executing logic.
- Grant roles only to trusted accounts and revoke them when no longer necessary.
- Verify storage layout compatibility when upgrading facets to prevent state corruption.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
This module stores access control data in diamond storage at the slot identified by `keccak256("compose.accesscontrol")`. All functions are `internal` and directly interact with the `AccessControlStorage` struct within this slot. Changes to roles made by any facet using this module are immediately reflected in the shared storage and visible to all other facets accessing the same storage position.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <RelatedDocs
    items={[
      {
        title: "OwnerTwoStepsMod",
        href: "/docs/library/access/OwnerTwoSteps/OwnerTwoStepsMod",
        description: "Related module in access",
        icon: "ðŸ“¦"
      },
      {
        title: "AccessControlPausableMod",
        href: "/docs/library/access/AccessControlPausable/AccessControlPausableMod",
        description: "Related module in access",
        icon: "ðŸ“¦"
      },
      {
        title: "AccessControlTemporalMod",
        href: "/docs/library/access/AccessControlTemporal/AccessControlTemporalMod",
        description: "Related module in access",
        icon: "ðŸ“¦"
      },
      {
        title: "OwnerMod",
        href: "/docs/library/access/Owner/OwnerMod",
        description: "Related module in access",
        icon: "ðŸ“¦"
      }
    ]}
  />
</div>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="AccessControlMod" />
</div>

<LastUpdated date="2025-12-30T17:40:43.790Z" />

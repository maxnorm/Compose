---
sidebar_position: 1
title: "AccessControlTemporalMod"
description: "Manage role assignments with time-based expirations."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/access/AccessControlTemporal/AccessControlTemporalMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manage role assignments with time-based expirations.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Roles can be granted with a specific `_expiresAt` timestamp.
- `isRoleExpired` allows checking the validity of a role assignment.
- `requireValidRole` provides a convenient, revert-based check for valid role assignments, including expiry.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module extends role-based access control by allowing roles to be granted with specific expiry timestamps. It ensures that access is automatically revoked once a role's validity period concludes, enhancing security and simplifying access management for temporary permissions.

---

## Storage

### AccessControlStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct AccessControlStorage {
    mapping(address account => mapping(bytes32 role => bool hasRole)) hasRole;
    mapping(bytes32 role => bytes32 adminRole) adminRole;
}`}
</ExpandableCode>

---
### AccessControlTemporalStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct AccessControlTemporalStorage {
    mapping(address account => mapping(bytes32 role => uint256 expiryTimestamp)) roleExpiry;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "ACCESS_CONTROL_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.accesscontrol\")`)"
    },
    {
      name: "TEMPORAL_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.accesscontrol.temporal\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### getAccessControlStorage

Returns the storage for AccessControl.

<ExpandableCode language="solidity" maxLines={8}>
{`function getAccessControlStorage() pure returns (AccessControlStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "AccessControlStorage",
      description: "The AccessControl storage struct."
    }
  ]}
  showRequired={false}
/>

---
### getRoleExpiry

function to get the expiry timestamp for a role assignment.

<ExpandableCode language="solidity" maxLines={8}>
{`function getRoleExpiry(bytes32 _role, address _account) view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The expiry timestamp, or 0 if no expiry is set."
    }
  ]}
  showRequired={false}
/>

---
### getStorage

Returns the storage for AccessControlTemporal.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (AccessControlTemporalStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "AccessControlTemporalStorage",
      description: "The AccessControlTemporal storage struct."
    }
  ]}
  showRequired={false}
/>

---
### grantRoleWithExpiry

function to grant a role with an expiry timestamp.

<ExpandableCode language="solidity" maxLines={8}>
{`function grantRoleWithExpiry(bytes32 _role, address _account, uint256 _expiresAt) returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to grant."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to grant the role to."
    },
    {
      name: "_expiresAt",
      type: "uint256",
      description: "The timestamp when the role should expire."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the role was granted, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### isRoleExpired

function to check if a role assignment has expired.

<ExpandableCode language="solidity" maxLines={8}>
{`function isRoleExpired(bytes32 _role, address _account) view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the role has expired or doesn\'t exist, false if still valid."
    }
  ]}
  showRequired={false}
/>

---
### requireValidRole

function to check if an account has a valid (non-expired) role. **Notes:** - Reverts with AccessControlUnauthorizedAccount If the account does not have the role. - Reverts with AccessControlRoleExpired If the role has expired.

<ExpandableCode language="solidity" maxLines={8}>
{`function requireValidRole(bytes32 _role, address _account) view;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check the role for."
    }
  ]}
  showRequired={false}
/>

---
### revokeTemporalRole

function to revoke a temporal role.

<ExpandableCode language="solidity" maxLines={8}>
{`function revokeTemporalRole(bytes32 _role, address _account) returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to revoke."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to revoke the role from."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the role was revoked, false otherwise."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="RoleGrantedWithExpiry" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Event emitted when a role is granted with an expiry timestamp.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleGrantedWithExpiry(
bytes32 indexed _role, address indexed _account, uint256 _expiresAt, address indexed _sender
);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was granted."
          },
          {
            name: "_account",
            type: "address",
            description: "The account that was granted the role."
          },
          {
            name: "_expiresAt",
            type: "uint256",
            description: "The timestamp when the role expires."
          },
          {
            name: "_sender",
            type: "address",
            description: "The account that granted the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="TemporalRoleRevoked" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Event emitted when a temporal role is revoked.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event TemporalRoleRevoked(bytes32 indexed _role, address indexed _account, address indexed _sender);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was revoked."
          },
          {
            name: "_account",
            type: "address",
            description: "The account from which the role was revoked."
          },
          {
            name: "_sender",
            type: "address",
            description: "The account that revoked the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="AccessControlRoleExpired" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when a role has expired.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlRoleExpired(bytes32 _role, address _account);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="AccessControlUnauthorizedAccount" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the account does not have a specific role.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlUnauthorizedAccount(address _account, bytes32 _role);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IAccessControlTemporal} from "@compose/access/AccessControlTemporal/IAccessControlTemporal.sol";
import {AccessControlTemporalMod} from "@compose/access/AccessControlTemporal/AccessControlTemporalMod.sol";

contract MyDiamondFacet {
    AccessControlTemporalMod internal accessControlTemporalMod;

    function initialize(address _diamondProxy) external {
        accessControlTemporalMod = AccessControlTemporalMod(_diamondProxy);
    }

    /**
     * Grant a temporary role to an account.
     */
    function grantTempAdmin(address _account, uint256 _duration) external {
        uint256 expiresAt = block.timestamp + _duration;
        accessControlTemporalMod.grantRoleWithExpiry(AccessControlMod.ADMIN_ROLE, _account, expiresAt);
    }

    /**
     * Check if an account has a valid, non-expired role.
     */
    function checkAdminRole(address _account) external view {
        accessControlTemporalMod.requireValidRole(AccessControlMod.ADMIN_ROLE, _account);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Use `grantRoleWithExpiry` to assign temporary permissions, preventing stale access.
- Leverage `requireValidRole` within your facets to enforce time-bound access control checks.
- Consider the implications of overlapping or sequential temporary roles to avoid unintended access gaps or overlaps.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
AccessControlTemporalMod interacts with the diamond's storage using the `ACCESS_CONTROL_STORAGE_POSITION` slot, which is managed by the `AccessControlStorage` struct. Facets integrating with this module can call its functions directly after initialization. The module's state for temporal roles is distinct and managed internally, but the core access control checks (like role existence) might rely on the base `AccessControlStorage`.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <RelatedDocs
    items={[
      {
        title: "AccessControlTemporalFacet",
        href: "/docs/library/access/AccessControlTemporal/AccessControlTemporalFacet",
        description: "Facet using AccessControlTemporalMod",
        icon: "ðŸ’Ž"
      },
      {
        title: "OwnerTwoStepsMod",
        href: "/docs/library/access/OwnerTwoSteps/OwnerTwoStepsMod",
        description: "Related module in access",
        icon: "ðŸ“¦"
      },
      {
        title: "AccessControlPausableMod",
        href: "/docs/library/access/AccessControlPausable/AccessControlPausableMod",
        description: "Related module in access",
        icon: "ðŸ“¦"
      }
    ]}
  />
</div>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="AccessControlTemporalMod" />
</div>

<LastUpdated date="2025-12-30T17:09:08.269Z" />

---
sidebar_position: 1
title: "NonReentrancyMod"
description: "Prevent reentrant function calls in facets."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Prevent reentrant function calls in facets.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Prevents reentrant function calls using a simple lock mechanism.
- Employs a custom error `Reentrancy` for explicit failure conditions.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The NonReentrancyMod library provides essential functions to prevent reentrant calls within your diamond facets. By implementing its `enter` and `exit` functions, you ensure that a function cannot be re-entered before its initial execution completes, safeguarding against common reentrancy vulnerabilities.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {NonReentrancyMod} from "@compose/libraries/NonReentrancyMod";

contract MyFacet {
    using NonReentrancyMod for NonReentrancyMod.State;

    NonReentrancyMod.State private _nonReentrancyState;

    /**
     * @notice Demonstrates a non-reentrant function.
     */
    function protectedFunction() external {
        _nonReentrancyState.enter(); // Lock the function

        // ... perform critical operations ...

        _nonReentrancyState.exit(); // Unlock the function
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always call `enter()` at the beginning of a function and `exit()` at the end to properly guard against reentrancy.
- Utilize the `Reentrancy` custom error for clear and gas-efficient error reporting if a reentrant call is detected.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The NonReentrancyMod library does not require direct integration with diamond storage. Its state is managed internally within the facet that uses it. Facets should declare an internal state variable of type `NonReentrancyMod.State` and use the library's functions to manage reentrancy protection.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-30T17:11:28.484Z" />

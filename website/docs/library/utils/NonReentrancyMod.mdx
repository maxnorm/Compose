---
sidebar_position: 1
title: "NonReentrancyMod"
description: "Prevent reentrant calls within diamond functions."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Prevent reentrant calls within diamond functions.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Prevents reentrant function calls, enhancing security.
- Uses explicit `enter` and `exit` functions for clear control flow.
- Minimal state overhead, suitable for integration into various facets.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module provides essential utilities to prevent reentrant attacks, a common vulnerability in smart contracts. By using `enter` and `exit` functions, facets can ensure that a function is not called again before its initial execution has completed, safeguarding contract integrity.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {LibNonReentrancy} from "@compose-protocol/diamond/contracts/modules/NonReentrancyMod.sol";

contract MyFacet {
    using LibNonReentrancy for uint256;

    uint256 _nonReentrancyState;

    function sensitiveOperation(uint256 _amount) external {
        _nonReentrancyState.enter();

        // Perform sensitive operations here...
        // For example, transfer funds, update state, etc.
        // If another external call from within this operation
        // tries to re-enter this function, it will revert.

        _nonReentrancyState.exit();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always pair `enter()` with `exit()` to prevent deadlocks or unintended reentrancy prevention.
- Place `enter()` at the very beginning of the function and `exit()` at the very end, before any return statements.
- Ensure the state variable used for tracking reentrancy is unique to the function or the specific context requiring protection.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The `NonReentrancyMod` operates by using a simple state variable (typically a `uint256` acting as a boolean flag) to track whether a function is currently executing. This state variable must be managed by the facet that integrates the module. The `enter` function sets the flag, and `exit` clears it. Facets must ensure this state variable is correctly initialized and managed within their storage layout. The module's functions are designed to be called directly by the facet, not as library functions that modify external state without explicit calls.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-30T14:36:58.761Z" />

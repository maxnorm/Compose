---
sidebar_position: 99
title: "NonReentrancyMod"
description: "Enforce non-reentrant execution within diamond functions."
gitSource: "https://github.com/maxnorm/Compose/blob/7e2dd824639f424be644c4ebbb3ca2508167329f/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Enforce non-reentrant execution within diamond functions.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Prevents recursive or reentrant function calls within a single transaction.
- Provides explicit `enter` and `exit` functions for clear control flow.
- Utilizes a custom `Reentrancy` error for gas-efficient error reporting.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The NonReentrancyMod provides essential guards to prevent reentrant calls within your diamond's facets. By using its `enter` and `exit` functions, you can safely manage state transitions and ensure that a function completes its execution without being interrupted by itself or another function within the same transaction context. This is crucial for maintaining data integrity and preventing unexpected behavior in complex interactions.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {NonReentrancyMod} from "@compose/modules/NonReentrancyMod.sol";

contract MyFacet {
    // Assume NonReentrancyMod is deployed and its address is accessible
    address internal constant NON_REENTRANCY_MOD_ADDRESS = address(0x123);

    function vulnerableFunction() external {
        NonReentrancyMod.enter(NON_REENTRANCY_MOD_ADDRESS);

        // ... perform critical operations ...

        NonReentrancyMod.exit(NON_REENTRANCY_MOD_ADDRESS);
    }

    function anotherFunction() external {
        // This function can be called by vulnerableFunction if reentrancy is not prevented
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always call `NonReentrancyMod.enter()` at the beginning of a function and `NonReentrancyMod.exit()` at the end. Ensure `exit` is called even if an error occurs using `try/catch` or other error handling mechanisms.
- Use the `Reentrancy` custom error to revert when reentrant calls are detected, providing clear feedback to the caller.
- Integrate the non-reentrancy checks as early as possible in your transaction flow to prevent potential exploits.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The NonReentrancyMod operates by managing a reentrancy guard state. When `enter` is called, it checks and sets a flag. If the flag is already set, it reverts with the `Reentrancy` error. `exit` clears this flag. Facets interacting with this module must ensure they call `enter` and `exit` in the correct order and handle potential reverts gracefully. The module's state is managed independently and does not directly interact with diamond storage structs.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-21T21:55:37.933Z" />

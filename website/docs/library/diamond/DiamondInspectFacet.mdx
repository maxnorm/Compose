---
sidebar_position: 510
title: "DiamondInspectFacet"
description: "Inspect diamond storage and function mappings."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/diamond/DiamondInspectFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Inspect diamond storage and function mappings.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Exposes diamond storage layout via `getStorage()` (internal).
- Provides a comprehensive mapping of function selectors to facet addresses via `functionFacetPairs()`.
- Designed for read-only inspection, enhancing security.
</Callout>

## Overview

The DiamondInspectFacet provides read-only access to the diamond's internal state and function routing information. It allows developers to query the diamond's storage layout and understand how function selectors are mapped to specific facet addresses.

---

## Storage

### FacetAndPosition

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FacetAndPosition {
    address facet;
    uint32 position;
}`}
</ExpandableCode>

---
### DiamondStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct DiamondStorage {
    mapping(bytes4 functionSelector => FacetAndPosition) facetAndPosition;
    /**
    * Array of all function selectors that can be called in the diamond.
    */
    bytes4[] selectors;
}`}
</ExpandableCode>

---
### FunctionFacetPair

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FunctionFacetPair {
    bytes4 selector;
    address facet;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.diamond\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### functionFacetPairs

Returns an array of all function selectors and their corresponding facet addresses. Iterates through the diamond's stored selectors and pairs each with its facet.

<ExpandableCode language="solidity" maxLines={8}>
{`function functionFacetPairs() external view returns (FunctionFacetPair[] memory pairs);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "pairs",
      type: "FunctionFacetPair[]",
      description: "An array of `FunctionFacetPair` structs, each containing a selector and its facet address."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import { DiamondInspectFacet } from "@compose/diamond/DiamondInspectFacet";
import { IDiamondCut } from "@compose/diamond/IDiamondCut";

contract Deployer {
    address immutable diamondAddress;

    constructor(address _diamondAddress) {
        diamondAddress = _diamondAddress;
    }

    function inspectStorage() external view returns (bytes memory) {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamondAddress);
        // Note: getStorage() is internal and cannot be called directly from here.
        // This example demonstrates calling a public/external view function.
        return abi.encode(inspectFacet.functionFacetPairs());
    }

    function getFunctionMappings() external view returns (DiamondInspectFacet.FunctionFacetPair[] memory) {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamondAddress);
        return inspectFacet.functionFacetPairs();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Integrate this facet to provide visibility into diamond operations without granting write access.
- Use `functionFacetPairs()` to dynamically discover facet implementations for a given function selector.
- Rely on the `DIAMOND_STORAGE_POSITION` constant for direct storage access in internal diamond logic, as demonstrated by `getStorage()`.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
This facet is designed for read-only operations and poses minimal direct security risks. Ensure that any logic consuming its output does not grant elevated privileges based solely on inspected state, as this could lead to vulnerabilities if the diamond's state is manipulated through other means.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="DiamondInspectFacet" />
</div>

<LastUpdated date="2025-12-30T17:11:04.494Z" />

---
sidebar_position: 510
title: "DiamondInspectFacet"
description: "Inspects diamond storage and facet mappings"
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/diamond/DiamondInspectFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Inspects diamond storage and facet mappings
</DocSubtitle>

<Callout type="info" title="Key Features">
- Exposes external view function to retrieve function-to-facet mappings.
- Provides access to the diamond's storage slot identifier.
- Self-contained and adheres to ERC-2535 diamond standard.
- Facilitates on-chain introspection of diamond composition.
</Callout>

## Overview

This facet provides read-only access to the diamond's internal state, specifically its storage layout and function-to-facet mappings. It allows external inspection of how functions are routed to their respective facets within the diamond proxy. Developers can use this facet to understand the diamond's configuration and composition.

---

## Storage

### FacetAndPosition

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FacetAndPosition {
    address facet;
    uint32 position;
}`}
</ExpandableCode>

---
### DiamondStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct DiamondStorage {
    mapping(bytes4 functionSelector => FacetAndPosition) facetAndPosition;
    /**
    * Array of all function selectors that can be called in the diamond.
    */
    bytes4[] selectors;
}`}
</ExpandableCode>

---
### FunctionFacetPair

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FunctionFacetPair {
    bytes4 selector;
    address facet;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.diamond\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### functionFacetPairs

Returns an array of all function selectors and their corresponding facet addresses. Iterates through the diamond's stored selectors and pairs each with its facet.

<ExpandableCode language="solidity" maxLines={8}>
{`function functionFacetPairs() external view returns (FunctionFacetPair[] memory pairs);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "pairs",
      type: "FunctionFacetPair[]",
      description: "An array of `FunctionFacetPair` structs, each containing a selector and its facet address."
    }
  ]}
  showRequired={false}
/>

<!-- Usage Example section commented out for now -->
<!--
## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity >=0.8.30;

import { IDiamond } from "@compose/diamond/IDiamond";
import { DiamondInspectFacet } from "@compose/diamond/DiamondInspectFacet";

contract DiamondInspector {
    function inspectDiamond(address _diamondAddress) public view returns (DiamondInspectFacet.FunctionFacetPair[] memory) {
        // Cast the diamond address to the DiamondInspectFacet interface to call its view functions.
        // The diamond must have the DiamondInspectFacet deployed and accessible.
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(_diamondAddress);

        // Call functionFacetPairs to retrieve mappings.
        return inspectFacet.functionFacetPairs();
    }

    // Example of accessing diamond storage, requires DiamondStorage struct definition
    // function getDiamondStorageSlot(address _diamondAddress) public view returns (bytes32) {
    //     DiamondInspectFacet inspectFacet = DiamondInspectFacet(_diamondAddress);
    //     // Note: getStorage() is internal, cannot be called directly externally.
    //     // This is an illustrative example; actual access would be within a facet.
    //     return DiamondInspectFacet.DIAMOND_STORAGE_POSITION;
    // }
}`}
</ExpandableCode>
-->

## Best Practices

<Callout type="tip" title="Best Practice">
- Deploy this facet as part of the initial diamond setup.
- Ensure the diamond proxy is correctly configured to route calls to this facet for inspection purposes.
- Do not modify the storage layout or function-to-facet mappings without careful consideration of the implications for inspection.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
This facet only exposes read-only information about the diamond's state and function mappings. It does not grant any administrative or state-modifying privileges. Follow standard Solidity security practices for any contract interacting with the diamond.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="DiamondInspectFacet" />
</div>

<LastUpdated date="2025-12-30T17:42:23.895Z" />

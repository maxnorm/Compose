---
sidebar_position: 510
title: "DiamondInspectFacet"
description: "Inspect diamond storage and facet mappings."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/diamond/DiamondInspectFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Inspect diamond storage and facet mappings.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Directly reads diamond storage via assembly for efficiency.
- Provides a complete mapping of function selectors to their implementing facets.
</Callout>

## Overview

The DiamondInspectFacet provides read-only access to the diamond's internal state and function mappings. It allows external querying of the diamond's storage layout and which facets handle specific function selectors, crucial for understanding and interacting with a deployed diamond.

---

## Storage

### FacetAndPosition

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FacetAndPosition {
    address facet;
    uint32 position;
}`}
</ExpandableCode>

---
### DiamondStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct DiamondStorage {
    mapping(bytes4 functionSelector => FacetAndPosition) facetAndPosition;
    /**
    * Array of all function selectors that can be called in the diamond.
    */
    bytes4[] selectors;
}`}
</ExpandableCode>

---
### FunctionFacetPair

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FunctionFacetPair {
    bytes4 selector;
    address facet;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.diamond\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### functionFacetPairs

Returns an array of all function selectors and their corresponding facet addresses. Iterates through the diamond's stored selectors and pairs each with its facet.

<ExpandableCode language="solidity" maxLines={8}>
{`function functionFacetPairs() external view returns (FunctionFacetPair[] memory pairs);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "pairs",
      type: "FunctionFacetPair[]",
      description: "An array of `FunctionFacetPair` structs, each containing a selector and its facet address."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IDiamondInspectFacet} from "@compose/contracts/facets/DiamondInspect/IDiamondInspectFacet.sol";

contract Consumer {
    address immutable DIAMOND_ADDRESS;

    constructor(address diamondAddress) {
        DIAMOND_ADDRESS = diamondAddress;
    }

    function inspectStorage() external view returns (bytes memory) {
        IDiamondInspectFacet inspectFacet = IDiamondInspectFacet(DIAMOND_ADDRESS);
        // Assuming storage is a single bytes32 value for simplicity in example
        return inspectFacet.getStorage();
    }

    function getFacetFunctionPairs() external view returns (struct IDiamondInspectFacet.FacetFunctionPair[] memory) {
        IDiamondInspectFacet inspectFacet = IDiamondInspectFacet(DIAMOND_ADDRESS);
        return inspectFacet.functionFacetPairs();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Use this facet for read-only introspection; avoid writing logic that depends on its state for core functionality.
- Integrate calls to `getStorage` and `functionFacetPairs` in off-chain tooling or dashboards for monitoring and debugging.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
This facet is read-only and does not introduce reentrancy risks. Ensure the diamond address is correctly set to prevent querying incorrect contract states.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="DiamondInspectFacet" />
</div>

<LastUpdated date="2025-12-30T14:36:33.428Z" />
